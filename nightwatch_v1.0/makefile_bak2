LIBCACHEEX_DIR=/usr/local/pcmalloc
CACHEEX_OBJ=${patsubst %.c,%.o, ${notdir ${wildcard *.c}}}
CACHEEX_CFLAGS=-Wall -lm -g -fPIC -Wformat -lpapi -O2
PAPI_PATH=/usr/local/papi/include
CACHEEX_LIB=${LIBCACHEEX_DIR}/libcacheex.so

all: ${CACHEEX_LIB}

${CACHEEX_LIB} : ${CACHEEX_OBJ}
	${CC} -fPIC -shared -o $@ $^ -ldl -I${PAPI_PATH}
${CACHEEX_PATH}/%.o : %.c
	${CC} -c ${CACHEEX_CFLAGS} $< -o $@




OBJ_DIR = ./obj
STATIC_LIB = ${OBJ_DIR}/libpcmalloc.a
DYNAMIC_LIB = ${OBJ_DIR}/libpcmalloc.so
TARGET = ${STATIC_LIB} ${DYNAMIC_LIB}
PAPI_PATH = /usr/local/papi/include

OBJS = ${patsubst %.c,${OBJ_DIR}/%.o,${wildcard *.c}}
LIBS =
CFLAGS = -Wall -lm -g -fPIC -Wformat -lpapi -O2
#CFLAGS = -Wall -lm -g -fPIC -Wformat -lpapi
CC = gcc

all : ${TARGET}


${OBJ_DIR}/%.o : %.c
	${CC} -c ${CFLAGS} $< -o $@ -I${PAPI_PATH}


${STATIC_LIB} : ${OBJS}
	ar -r -o $@ $^

${DYNAMIC_LIB} : ${OBJS}
	${CC} -fPIC -shared -o $@ $^ -ldl -I${PAPI_PATH}

clean:
	rm ${OBJ_DIR}/*.o

.PHONY: all clean

